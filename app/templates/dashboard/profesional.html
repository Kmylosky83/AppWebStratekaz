{% extends "base.html" %}

{% block title %}Dashboard Profesional - StrateKaz{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Secci√≥n de indicadores clave -->
    <section id="indicadores" class="dashboard-section mb-5">
        <div class="card shadow-sm">
            <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
                <h4 class="section-title mb-0">
                    <i class="fas fa-chart-line me-2"></i>Indicadores Clave
                </h4>
                <div>
                    <a href="#" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-expand-alt me-1"></i>Expandir
                    </a>
                </div>
            </div>
            <div class="card-body">
                <p class="section-subtitle mb-4">Resumen de la actividad actual</p>
                
                <div class="row g-3">
                    <div class="col-md-3 col-sm-6">
                        <div class="stats-card">
                            <div class="stats-card-body">
                                <div class="stats-card-icon bg-primary">
                                    <i class="fas fa-tasks"></i>
                                </div>
                                <div class="stats-card-content">
                                    <h5 class="stats-card-title">{{ stats.pending_tasks }}</h5>
                                    <p class="stats-card-text">Tareas Pendientes</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-4 mb-md-0">
                        <div class="stats-card">
                            <div class="stats-card-body">
                                <div class="stats-card-icon bg-success">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="stats-card-content">
                                    <h5 class="stats-card-title">{{ stats.total_documentos }}</h5>
                                    <p class="stats-card-text">Documentos</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6 mb-4 mb-md-0">
                        <div class="stats-card">
                            <div class="stats-card-body">
                                <div class="stats-card-icon bg-warning">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stats-card-content">
                                    <h5 class="stats-card-title">{{ stats.total_empresas }}</h5>
                                    <p class="stats-card-text">Clientes</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <div class="stats-card">
                            <div class="stats-card-body">
                                <div class="stats-card-icon bg-info">
                                    <i class="fas fa-project-diagram"></i>
                                </div>
                                <div class="stats-card-content">
                                    <h5 class="stats-card-title">0</h5>
                                    <p class="stats-card-text">Proyectos</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>         
            </div>
        </div>
    </section>
    
    <!-- M√≥dulos disponibles -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5>M√≥dulos Disponibles</h5>
                <a href="{{ url_for('dashboard.modulos') }}" class="btn btn-sm btn-primary">
                    <i class="fas fa-th-large me-1"></i>Ver todos
                </a>
            </div>
            
            <div class="row g-4 justify-content-center">
                {% for modulo in modulos %}
                <div class="col-md-6 col-lg-3 mb-3">
                    <div class="module-card hover-effect">
                        <div class="module-card-icon" style="background-color: {% if modulo.id == 'sg' %}#ec268f{% elif modulo.id == 'sgsst' %}#ffc107{% elif modulo.id == 'pesv' %}#000000{% else %}#7a1b74{% endif %};">
                            <i class="fas fa-{{ modulo.icon }}"></i>
                        </div>
                        <div class="module-card-content">
                            <h4 class="module-card-title">{{ modulo.name }}</h4>
                            <p class="module-card-description">{{ modulo.description }}</p>
                            
                            {% if modulo.id != 'herramientas' %}
                            <a href="#" 
                               class="module-card-link"
                               data-module-popup="true"
                               data-module-name="{{ modulo.name }}"
                               data-module-id="{{ modulo.id }}"
                               data-module-icon="{{ modulo.icon }}">
                                Acceder
                            </a>
                            {% else %}
                            <a href="{{ modulo.url|default('#') }}" class="module-card-link">
                                Acceder
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Informaci√≥n Complementaria -->
    <div class="row mb-4">
        <!-- Actividad Reciente -->
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title">üöÄ Tu Viaje Empresarial</h5>
                </div>
                <div class="card-body p-0">
                    {% if stats.recent_activity %}
                        <ul class="list-group list-group-flush">
                            {% for activity in stats.recent_activity %}
                            <li class="list-group-item d-flex align-items-center">
                                <div class="me-3">
                                    <i class="{{ activity.icon }} text-primary"></i>
                                </div>
                                <div>
                                    <p class="mb-1">{{ activity.text }}</p>
                                    <small class="text-muted">{{ activity.time }}</small>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <div class="text-center py-4">
                            <img src="{{ url_for('static', filename='images/no-activity.svg') }}" alt="No hay actividad" class="img-fluid mb-3" style="max-height: 120px;">
                            <h6>No hay actividad reciente</h6>
                            <p class="text-muted">Tu actividad reciente aparecer√° aqu√≠</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Pr√≥ximos Eventos -->
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title">üìÖ Horizontes que se Aproximan</h5>
                </div>
                <div class="card-body">
                    {% if stats.upcoming_events %}
                        <ul class="list-group list-group-flush">
                            {% for event in stats.upcoming_events %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="my-0">{{ event.title }}</h6>
                                    <small class="text-muted">{{ event.date.strftime('%d/%m/%Y %H:%M') }}</small>
                                </div>
                                <span class="badge bg-primary rounded-pill">
                                    <i class="fas fa-calendar-alt"></i>
                                </span>
                            </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <div class="text-center py-4">
                            <img src="{{ url_for('static', filename='images/no-events.svg') }}" alt="No hay eventos" class="img-fluid mb-3" style="max-height: 120px;">
                            <h6>No hay eventos pr√≥ximos</h6>
                            <p class="text-muted">Los eventos programados aparecer√°n aqu√≠</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Tareas Pendientes -->
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title">‚è≥ Misiones en Progreso</h5>
                </div>
                <div class="card-body p-0">
                    {% if pendientes %}
                        <ul class="list-group list-group-flush">
                            {% for tarea in pendientes %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="tarea{{ tarea.id }}">
                                    <label class="form-check-label" for="tarea{{ tarea.id }}">
                                        {{ tarea.title }}
                                    </label>
                                </div>
                                <span class="badge bg-{{ 'danger' if tarea.priority == 'alta' else 'warning' if tarea.priority == 'media' else 'secondary' }} rounded-pill">
                                    {{ tarea.priority|upper }}
                                </span>
                            </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <div class="text-center py-4">
                            <img src="{{ url_for('static', filename='images/no-tasks.svg') }}" alt="No hay tareas" class="img-fluid mb-3" style="max-height: 120px;">
                            <h6>No hay tareas pendientes</h6>
                            <p class="text-muted">¬°Excelente! Has completado todas tus tareas</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Eventos para interacci√≥n con m√≥dulos no disponibles
        document.querySelectorAll('[data-module-popup="true"]').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                
                const moduleName = this.getAttribute('data-module-name');
                const moduleId = this.getAttribute('data-module-id');
                
                Swal.fire({
                    title: '¬°Pr√≥ximamente!',
                    html: `
                        <div class="text-center">
                            <div class="module-preview-icon" style="background-color: #ec268f;">
                                <i class="fas fa-${this.getAttribute('data-module-icon')}"></i>
                            </div>
                            <h5>${moduleName}</h5>
                            <p>Estamos trabajando para ofrecerte este m√≥dulo muy pronto.</p>
                            <form id="waitlist-form" class="mt-4">
                                <input type="hidden" name="module_id" value="${moduleId}">
                                <div class="form-group mb-3">
                                    <input type="email" class="form-control" id="email" placeholder="tucorreo@ejemplo.com" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Unirme a la lista de espera</button>
                            </form>
                        </div>
                    `,
                    showConfirmButton: false,
                    showCloseButton: true
                });
                
                // Manejar env√≠o del formulario de lista de espera
                document.getElementById('waitlist-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    const email = this.querySelector('#email').value;
                    
                    Swal.fire({
                        icon: 'success',
                        title: '¬°Gracias!',
                        text: 'Te notificaremos cuando este m√≥dulo est√© disponible.',
                        confirmButtonColor: '#ec268f'
                    });
                });
            });
        });
    });
</script>
{% endblock %}

{% block styles %}
<style>
    /* Estilos espec√≠ficos para el dashboard */
    .module-preview-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
        font-size: 2.5rem;
        color: white;
    }
</style>
{% endblock %}